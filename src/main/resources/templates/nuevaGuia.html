<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/fragments/busqueda.css}">
    <link rel="stylesheet" th:href="@{/css/nuevaGuia.css}">
    <title>Gu√≠as</title>
</head>
<body>
    <main>
        <!-- HEADER -->
		<div th:insert="./fragments/header"></div>
		<!-- HEADER -->

		<!-- SIDEBAR -->
		<div th:insert="./fragments/sidebar"></div>
		<!-- SIDEBAR -->

        <div class = "contenido">
            <div class="nuevoCampo">
                <h1> 1. Titulo de la guia </h1>
                <input type="text" id="titulo" name="titulo">
            </div>
            
            <div class="nuevoCampo">
                <h1> 2. Selecciona etiquetas </h1>
                <div class = "buscaEtiquetas">	
    
                    <button id = "campeon">
                        CAMPEON
                    </button>
        
                    <button id = "posicion">
                        POSICION
                    </button>

                    <button id = "general">
                        GENERAL
                    </button>

                </div>
            </div>

            <div class="nuevoCampo">
                <h1> 3. Selecciona posiciones </h1>
                <div class = "buscaPosicion">	
                    
                    <button id="all">
                        <img th:src="@{/img/posiciones/all.svg}">
                    </button>
                    
                    <button id="top">
                        <img th:src="@{/img/posiciones/top.svg}">
                    </button>
        
                    <button id="jgl">
                        <img th:src="@{/img/posiciones/jgl.svg}">
                    </button>
        
                    <button id="mid">
                        <img th:src="@{/img/posiciones/mid.svg}">
                    </button>
        
                    <button id="bot">
                        <img th:src="@{/img/posiciones/bot.svg}">
                    </button>
        
                    <button id="sup">
                        <img th:src="@{/img/posiciones/sup.svg}">
                    </button>

                </div>
            </div>

            <div class="nuevoCampeon">
                <h1> 4. Selecciona campeon </h1>
                <div class = "nuevoCampeonSeleccionado">
                    <input type="text" id="campeonSelector" name="campeonSelector">
                </div>
                <div class="nuevoCampeonGrid"></div>
			</div>
            

            </div>

        </div>

        <script>
            
            var titulo;
            const seleccion = {etiquetas: new Set(), posiciones: new Set()}
            
            function toggle(set, key) {
                if (set.has(key)) set.delete(key); else set.add(key);
            }

            // TITULO

            var element = document.getElementById("titulo");
            element.addEventListener('click', function() {
                titulo = this.value;
            });

            // ETIQUETAS

            const etiquetas = ["campeon", "posicion", "general"];

            for (var i = 0; i < etiquetas.length; i++) {
                var element = document.getElementById(etiquetas[i]);
                element.addEventListener('click', function() {
                    toggle(seleccion.etiquetas, this.id);
                    this.classList.toggle('bordeAmarillo')
                });
            }

            // POSICIONES

            const posiciones = ["all", "top", "jgl", "mid", "bot", "sup"];

            for (var i = 0; i < posiciones.length; i++) {
                var element = document.getElementById(posiciones[i]);
                element.addEventListener('click', function() {
                    toggle(seleccion.posiciones, this.id);
                    this.classList.toggle('bordeAmarillo')
                });
            }

            function actualizaConJson(json) {

                const grid = document.querySelector('.nuevoCampeonGrid');
                const searchBar = document.getElementById('campeonSelector');
                const campeonSeleccionado = document.querySelector('.nuevoCampeonSeleccionado');

                while (grid.firstChild) {
                    grid.removeChild(grid.firstChild);
                }
                
                var numCampeones = 0;
                var i = 0;
                const regex = new RegExp(searchBar.value);
                while (i < json.length && numCampeones < 10) {
                    if (regex.test(json[i].nombre)) {
                        const image = document.createElement('img');
                        image.src = "/img/campeones/" + json[i].nombre + ".png";
                        image.addEventListener('click', function() {
                            if (campeonSeleccionado.children.length >= 2) {
                                const secondChild = campeonSeleccionado.children[1];
                                campeonSeleccionado.removeChild(secondChild);
                            }
                            const seleccionado = document.createElement('img');
                            seleccionado.src = this.src;
                            campeonSeleccionado.appendChild(this);
                        });

                        grid.appendChild(image);
                        numCampeones++;
                    }
                    i++;
                }
                
            
            }

            // CAMPEONES
            
            var test;
            document.querySelector("#campeonSelector").addEventListener("input", () => 
                go('/api/campeones', 'GET', {
                        etiquetas: [... seleccion.etiquetas].join(","), 
                        posiciones: [... seleccion.posiciones].join(",")
                    })
                    .then(json => 
                        console.log("OK", actualizaConJson(json)))
                    .catch(e => console.log("ERR", e))
            );
            
            
            
        </script>
            
		<script type="text/javascript" src="js/iw.js"></script>
		<script type="text/javascript" src="js/stomp.js"></script>
    </main>
</body>
</html>
